[
  {
    "objectID": "talk.html#openneuro-goals",
    "href": "talk.html#openneuro-goals",
    "title": "Maintaining large datasets at scale",
    "section": "OpenNeuro goals",
    "text": "OpenNeuro goals\nHigh availability\n\nFiles are published to S3 (exporttree=yes versioning=yes)\nDatasets are published to GitHub\n\nVersions are lightweight tags\n\n\nNo need to hit OpenNeuro servers to retrieve data\n\nData integrity\n\nRoutine git annex fsck on server and S3 remotes\nCold storage backups\nPublic mirrors of git repositories"
  },
  {
    "objectID": "talk.html#detecting-problems",
    "href": "talk.html#detecting-problems",
    "title": "Maintaining large datasets at scale",
    "section": "Detecting problems",
    "text": "Detecting problems\nWith &gt;2500 datasets, supplied by users, managed by an evolving code base, problems arise. How to detect them?\n\nSync failures with GitHub are often a good indicator:\n󰅂 scripts/check-github-sync\n2025-10-03 19:00:49 [error    ] Missing latest tag             dataset=ds004021 tag=1.0.1\n2025-10-03 19:00:50 [error    ] Missing latest tag             dataset=ds004212 tag=3.0.0\n2025-10-03 19:00:51 [error    ] GraphQL query error           \n2025-10-03 19:00:51 [warning  ] mismatch: b7b87f8(2.0.3) != c995770 dataset=ds004516 tag=2.0.3\n2025-10-03 19:00:51 [error    ] Missing latest tag             dataset=ds004639 tag=1.0.0\n2025-10-03 19:00:52 [warning  ] mismatch: 2b53548(1.0.2) != 8222107 dataset=ds004837 tag=1.0.2\n2025-10-03 19:00:52 [error    ] GraphQL query error           \n2025-10-03 19:00:54 [error    ] Missing latest tag             dataset=ds005293 tag=1.0.0\n2025-10-03 19:00:54 [error    ] Missing latest tag             dataset=ds005381 tag=1.1.0\n2025-10-03 19:00:56 [warning  ] mismatch: 554e144(1.0.0) != 8f0cfb1 dataset=ds006111 tag=1.0.0\n2025-10-03 19:00:56 [error    ] Missing latest tag             dataset=ds006319 tag=1.0.0\nFetching ds006801 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸ 1496/1502\nChecking ds006468 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸ 1496/1502\n\n\nTypically a missing tag means an incomplete export or large files outside the annex.\n\n\nhttps://github.com/OpenNeuroOrg/openneuro/blob/master/scripts/check-github-sync\n\n\nWraps: git ls-remote $REPO $TAG"
  },
  {
    "objectID": "talk.html#problems-and-solutions",
    "href": "talk.html#problems-and-solutions",
    "title": "Maintaining large datasets at scale",
    "section": "Problems and solutions",
    "text": "Problems and solutions\n\n\nProblem: File corruption in transit cannot be detected server-side\n\nSolution: Upload client hashes files, creates a commit, and pushes\nhttps://github.com/OpenNeuroOrg/openneuro/blob/master/cli/src/worker/git.ts\n\n\n\n\n\nProblem: Files can become un-annexed (typically race condition)\n\nSolution: Replay commits since last publishable state, fixing as you go\nhttps://github.com/OpenNeuroOrg/openneuro/blob/master/scripts/reannex-to-tag.sh\ngit rebase -X theirs --exec $EXEC_SCRIPT $REF\ngit diff-tree [...] | git rm --cached --pathspec-from-file=- && git annex add && git commit\n\n\n\n\n\nProblem: Older datasets have unversioned S3 remotes\n\nSolution: Clear out S3 prefix and re-export\n\n\n\n\n\nProblem: Exports can be interrupted\n\nSolution: Re-export tags and git push"
  },
  {
    "objectID": "talk.html#quick-copy-on-write-backups",
    "href": "talk.html#quick-copy-on-write-backups",
    "title": "Maintaining large datasets at scale",
    "section": "Quick, copy-on-write backups",
    "text": "Quick, copy-on-write backups\nBefore potentially destructive operations, we make full backups. Using git clone and rsync --link-dest, this takes seconds.\n% DS=ds005256\n% git clone $DS{,.bak}\nCloning into 'ds005256.bak'...\ndone.\nUpdating files: 100% (28408/28408), done.\n% rsync -a --ignore-existing --link-dest=../$DS $DS{,.bak}/.\n% rsync -a --delete $DS{,.bak}/.\n\nLess than 20s and 1GB needed to back up a 2TB dataset:\n% du -sh $DS.bak\n2.1T    ds005256.bak\n% du -sch $DS*\n2.1T    ds005256\n570M    ds005256.bak\n2.1T    total\n% diff -r $DS*"
  }
]